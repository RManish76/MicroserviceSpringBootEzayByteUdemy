*1* Spring cloud project provides a dependency known as spring config server and spring config client.
        spring config server - > stores the details and properties so that other application can fetch
                                    details from here.
        Spring config client - > application which will fetch config details from config server.

        added dependency in configserver project
                -> config server, actuator

*2* Start
    Added @EnableConfigServer  --> saying to spring this project will be storing confgiuration/properties
            and other applications will fetch those details from it.

    There multiple way to store confgiuration details like classpath, file sysem, database, githubrepo etc
    we are going to discuss 3 of them
        1. Class Path storage
        2. Store it in file system in local or server and then we can read from that folder
        3. using github

*3* Added name of server which we want
        in application.yml we need to add spring.application.name="configserver"
        the name can be anything and this is the name we are going to use to for this sever and
        connect to this server.

        Added confgiuration related to accounts, cards, loans in config folder under resources in configserver project

        now added spring.profiles.active=native in application.yml of configserver project
            this tell to spring cloud config servet that to cativate a native profile of spring cloud config
            server, so whenever we are trying to use a classpath to store all our configuration, we need to
            make sure we are activating the native profile.

            Once we define the profile activation details.

            now we need to add spring.cloud.config.server.native.search-locations="classpath/config"
            this mentions the serach location of profiles, using this property only we tell spring cloud
            config server where our properties are stored. And right now our properties are stored inside
            the classpath -> where properties are         config -> folder location of classpath

        now intital setup is done. lets run the configserver applicatiion
        after running we can serach in browser
            GET        localhost:8071/accounts/prod  -> to fetch accounts_prod.yml and accounts.yml properties
            GET        localhost:8071/cards/prod      -> to fetch cards_prod.yml and cards.yml properties
            GET        localhost:8071/accounts/default -> to get only default profile
        
        we got issue as we are getting only default accounts.yml with  link localhost:8071/accounts/prod 
            the issue is file nameing convetion.
            the name should be accounts-prod.yml not accounts_prod.yml similarly for others.

        After correcting the issue we are getting both default and prod profile.
        which is expected and when we activate the other application with prod profile they will pick
        the prod profile and ignore the default one.


*4* spring cloud config clinet
    Now we'll do configuration in accounts, card, loans as config client
        1st in accounts default profile applicatiion.yml we removed all profile details
        only kept applicatiion name as our applicatiion is going to find same name on config server
        then we also mentioned a default profile as prod so that our applicatiion start with prod profile
        by defaule if it able to find prod profile in config server.

    Added config client dependency to pom of accounts microservice.
    and since we are adding configClient we need not add spring cloude version as well and
    dependencyManagement also

    then added spring.config.import="optional:configserver:http://localhost:8071/" in application.yml of accounts microservice
        configserver -> indication to accoutnsMicroservice springboot applicatiion it is going to connect 
                and this configserver in fixed keyword it nothing realted to name which we gave to other microservice
                ConfigServer
        optional: -> if this applicatiion is not able to connect with ConfigServer for any reason it should
                    still start the applicatiion with default confgiuration
                if we have scenario that without configserver it should not start the applicatiion then we can remove it.


    Now setup of accounts microservice as config client completed and as defualt we have
    set the config to look for prod. means whenever we start the applicatiion normally it'll
    start with prod profile.
    and if we want to activete another profile we can run it using command line. like below
        java -jar accoutnsMicroservice.jar --spring.profiles.active=qa


    Now with same process lets update the cards and loan microservice as config clinet

    *2* Now we'll modify the configserver to filetype from classpath(stored with code)
        issue with classpath is that any developer working on configserver will able to see all
        properties which creates security issue as those developer might not be authorised to
        look at properties.

        In file path system we need palce all profile in a folder local/remote and then we'll
        update applicatiion.yml of ConfigServer from classpath to filsystem and give the location
        of that folder.

    *3* After that we moved to repo based
        we put all our config file in a repo then modified the applicatiion.yml of configserver to
        fetch the config files from the repo at start of the application.

    *4* Introducing the encyrption/decytprion
        we can introduce a encyrption key in the applicatiion.yml of configserver.
        After Introducing the encyrption in applicatiion.yml the applicatiion automatically expose a
        rest endpoint which is http://localhost:8071/encrypt for encryption and http://localhost:8071/decrypt for decryption.
        Now we can make a call to http://localhost:8071/encrypt and pass the text in body
        it'll return us the encrypted form of that text as per key.
        And in request if we sent the encrypted (no need of any prefix) text to http://localhost:8071/decrypt then it'll return us the decrypted value

        similarly if our data is encrypted in repo/file and we have configred the key applicatiion.yml
        then when we request that through config server vai any request/application it'll first decrypt that data then return to us.
        here only conditionis that at repo we need to add prefix cipherr like "{cipher} encrypted data" to let configserver
        know that the text which you are reciving is encrypted. if this prefix is not there then it'll treat as normal data.

        for demo: we'll encrypt the email id of accounts_prod user the will try to make request for that
        from http://localhost:8071/accounts/prod of config server or http://localhost:8080/api/contact-info of accountsMS in boht cases
        we should get the emailid from the repo instead of the encrypted data.
        email:aishwarya@eazybank.com    encrypted: 35a1f2cccec24dc948d4d129704d9ce5f63548c388cc0c99fa91255d22a76cc22af55212d59e94ae89fc826a98bdebca
        at repo "{cipher}35a1f2cccec24dc948d4d129704d9ce5f63548c388cc0c99fa91255d22a76cc22af55212d59e94ae89fc826a98bdebca"
        restarted the configserver. in response only email we are getting

*5* Refresh of config if configfiles have some change without restarting the code.
    First we need actuator dependency in pom to achieve that.
    then update AccountsContactInfoDto in accoutnsMicroservice from record type to class.
    As we know that record type only allow us to 1st time update the record from null as
    all parameter in record is final.
    And in our case we want to update the data if config changed means we can no longer use record type.
    For loans and card i have keept the contactinfodto as class only.

    After that we need to update the applicatiion.yml to enable the actuator in all MS
        management.endpoints.web.exposure.include="*"  it'll expose all actuator restendpoint.
        if we want expose only refresh then we need to mention ="refresh". it'll expose only refresh
        endpoint of actuator.
        management is actuator  and although we only need only resfresh rest endpoing but going for all
        do the same in loans, cards.

    Now once everything is done we can make changes to config profile in repo and when we hit
    rest endpoints of ConfigServer it'll show the refreshed data.
    But but but, when we try to get data from any other MS like accounts, loans we'll get old data only.
    because when these MS started then only they connected to configServer and pulled the required details and
    when we are trying to get detials from these MS, they are not reaching to configServer again they'll show
    the old data only.
    Now to get the new data for these MS we need hit the actuator refrest POST request to ask these
    each MS that they need to refresh their profile data by reaching the config server again.
    if we go to https://localhost:8080/actuator  --> it'll show all actuator rest point as we have use "*" in enable
        to refresh the data from the refresh endpoint is without any body 
            POST http://localhost:9000/actuator/refresh --> for cards MS
                response 
                        [
                            "config.client.version",
                            "cards.message"
                        ]
            POST http://localhost:8000/actuator/refresh --> for accountss MS
                response 
                        [
                            "config.client.version",
                            "accounts.message"
                        ]
            POST http://localhost:8090/actuator/refresh --> for loans MS
                response 
                        [
                            "config.client.version",
                            "loans.message"
                        ]
        after hitting this endpoints we'll get new data from the repo.

    But we still have issue that if we have a lot of MS the we need to execute the refresh endpoint many
    times which is inconvinece.


*6* Now we are going to introduce spring cloud bus in project.
    As we have seen previously that we need call the actuator refresh endpoint multiple times manualy
    as we have multiple MS.
    To mitegate it we need some message broker which will publish event to refresh the config 
    and each MS will refresh as response of that event.
    To achieve this we have SPRING CLOUD BUS which works with both RabbitMQ and Kaffka.
    
    we are going to use the RabbitMQ. So we need to install the RabbitMQ localy.
    We are going to use docker to install the RabbitMQ using below cmd in cmd. present at RabbitMQ website
    below command will install and will run the rabbitmq also

        docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:4-management

    post that we need add dependency in each MS including configServer. in spring intitalizer found similar but not exact dependency as the below 
    but it was mentioned in spring cloud Bust website: https://docs.spring.io/spring-cloud-bus/reference/quickstart.html and available in maven repo
		<!-- Spring Cloud Bus for RabbitMQ -->
		<dependency>
		    <groupId>org.springframework.cloud</groupId>
		    <artifactId>spring-cloud-starter-bus-amqp</artifactId>
		</dependency>      

    After this make sure we re enabling the actuator API path which is bus refresh inside all our MS instances.
        we have already enabled using "*" which will enable all actuator/management endpoint. no need to dedicately enbale bus refresh end point.

    Now like we provide details of database like port username password, similarly we need to do that for
    RabbitMQ as well. and since we want all or our MS to connect to same RabbitMQ we need mention same details
    at all MS in applicatiion.yml

                    #detail of rabbitMQ
                    rabbitmq:
                        host: "localhost"
                        port: 5672
                        username: "guest"
                        password: "guest"

    The above details of rabbitMQ is default value. and even if we don't mention it, springboot is smart
    enough to connect to the rabbitMQ with default value.

    now lets start the configServer MS then other MS. after that we can make changes to config profiles like
    we did earlier and hit application specific contact-info endpoint we'll see that changes not reflecting
    like eariler. now either we have to hit POST request of refresh actuator for each MS or as we have implemented
    bus service then we can hit POST http://localhost:8080/actuator/busrefresh or from any other MS but need to do
    only one time which will send the event to
    rabbitMQ to refresh the profile config and all MS connected to this RabbitMQ will refresh automatically